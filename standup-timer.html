<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Een handige standup timer voor timeboxing tijdens team standups">
    <meta name="theme-color" content="#0d1117">
    <title>Standup Timer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚è±Ô∏è</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0d1117;
            min-height: 100vh;
            padding: 20px;
            color: #c9d1d9;
            transition: padding 0.3s;
        }

        body.fullscreen-active {
            padding: 0;
            overflow: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #161b22;
            border-radius: 12px;
            border: 1px solid #30363d;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        /* Setup Panel */
        .setup-panel {
            background: #0d1117;
            padding: 25px;
            border-bottom: 1px solid #30363d;
        }

        .setup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .setup-header h1 {
            font-size: 28px;
            color: #58a6ff;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .toggle-setup {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            min-height: 44px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .toggle-setup:hover {
            background: #30363d;
            border-color: #58a6ff;
        }

        .setup-content {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .setup-content.hidden {
            display: none;
        }

        .setup-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .setup-section:hover {
            border-color: #58a6ff;
            box-shadow: 0 2px 8px rgba(88, 166, 255, 0.1);
        }

        .setup-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #c9d1d9;
            margin: 0 0 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setup-section-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .label-icon {
            font-size: 16px;
            margin-right: 4px;
        }

        .input-hint {
            font-size: 12px;
            color: #8b949e;
            margin-top: 4px;
            font-style: italic;
        }

        .hint-icon {
            margin-right: 6px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #c9d1d9;
            font-size: 14px;
        }

        .input-group input {
            padding: 14px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            font-size: 17px;
            color: #c9d1d9;
            transition: all 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        .input-group input:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .input-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .input-group label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin: 0;
            cursor: pointer;
            accent-color: #3fb950;
            -webkit-appearance: checkbox;
            appearance: checkbox;
            flex-shrink: 0;
        }

        .speaker-order-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            padding: 10px;
            background: rgba(13, 17, 23, 0.5);
            border-radius: 8px;
        }

        .speaker-order-item {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .speaker-order-item.past {
            background: #21262d;
            color: #8b949e;
            opacity: 0.6;
        }

        .speaker-order-item.current {
            background: #238636;
            color: #fff;
            border-color: #3fb950;
            box-shadow: 0 0 10px rgba(63, 185, 80, 0.3);
        }

        .speaker-order-item.upcoming {
            background: #161b22;
            color: #c9d1d9;
            border-color: #30363d;
        }

        .language-toggle-btn {
            width: 100%;
            padding: 14px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            font-size: 24px;
            line-height: 1;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            -webkit-appearance: none;
            appearance: none;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .language-toggle-btn:hover {
            border-color: #58a6ff;
            background: #161b22;
            transform: scale(1.05);
        }

        .language-toggle-btn:active {
            transform: scale(0.95);
        }

        .language-toggle-btn:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .setup-section.names-management {
            grid-column: 1 / -1;
        }

        .setup-section.actions-section {
            margin-top: 8px;
        }

        .names-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 8px;
            background: #0d1117;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .name-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 6px;
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
            font-size: 13px;
            font-weight: 500;
            border: 1px solid transparent;
        }

        .name-item.present {
            background-color: rgba(46, 160, 67, 0.15);
            border-color: rgba(46, 160, 67, 0.3);
            color: #3fb950;
        }

        .name-item.present:hover {
            background-color: rgba(46, 160, 67, 0.25);
            border-color: rgba(46, 160, 67, 0.5);
        }

        .name-item.absent {
            background-color: rgba(248, 81, 73, 0.15);
            border-color: rgba(248, 81, 73, 0.3);
            color: #f85149;
        }

        .name-item.absent:hover {
            background-color: rgba(248, 81, 73, 0.25);
            border-color: rgba(248, 81, 73, 0.5);
        }

        .name-item .name-text {
            flex: 1;
            pointer-events: none; /* Laat clicks door naar parent item */
        }

        .name-item .delete-btn {
            background: transparent;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 0;
            margin-left: 4px;
            font-size: 16px;
            line-height: 1;
            opacity: 0.7;
            transition: opacity 0.2s;
            flex-shrink: 0;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .name-item .delete-btn:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.2);
        }

        .add-name-container {
            display: flex;
            gap: 6px;
        }

        .add-name-container input {
            flex: 1;
            padding: 10px 12px;
            font-size: 14px;
        }

        .add-name-container .btn-small {
            padding: 10px 16px;
            flex: 0 0 auto;
            min-width: 44px;
            font-size: 16px;
        }

        .names-hint {
            font-size: 11px;
            color: #8b949e;
            margin-top: 4px;
            line-height: 1.4;
        }

        .names-list:empty::before {
            content: attr(data-empty-text);
            display: block;
            width: 100%;
            padding: 12px;
            text-align: center;
            color: #8b949e;
            font-style: italic;
            font-size: 13px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .button-group-primary {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .button-group-secondary {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-large {
            flex: 1;
            padding: 16px 24px;
            font-size: 18px;
            font-weight: 600;
        }

        .btn-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-height: 44px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .btn-primary {
            background: #238636;
            color: white;
            border: 1px solid #2ea043;
        }

        .btn-primary:hover {
            background: #2ea043;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 160, 67, 0.3);
        }

        .btn-secondary {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }

        .btn-secondary:hover {
            background: #30363d;
            border-color: #58a6ff;
        }

        .btn-secondary.standup-complete {
            background: #238636;
            color: #fff;
            border-color: #3fb950;
            box-shadow: 0 0 20px rgba(63, 185, 80, 0.5);
            animation: pulse-glow 2s ease-in-out infinite;
            font-weight: 600;
            transform: scale(1.05);
        }

        .btn-secondary.standup-complete:hover {
            background: #2ea043;
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(63, 185, 80, 0.7);
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(63, 185, 80, 0.5);
            }
            50% {
                box-shadow: 0 0 30px rgba(63, 185, 80, 0.8);
            }
        }

        .btn-test {
            background: #1f6feb;
            color: white;
            border: 1px solid #388bfd;
        }

        .btn-test:hover {
            background: #388bfd;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(56, 139, 253, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            padding: 40px;
            min-height: 0;
        }

        /* iPad en tablet optimalisatie - single column tijdens standup */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .people-overview {
                display: none !important; /* Verberg personen lijst op tablet */
            }

            .timer-section {
                padding: 15px;
                min-height: auto;
            }

            .timer-display {
                font-size: 90px;
                margin: 15px 0;
                letter-spacing: 2px;
            }

            .current-person {
                font-size: 26px;
                margin-bottom: 10px;
            }

            .next-person-info {
                font-size: 16px;
                margin-bottom: 10px;
            }

            .total-time {
                font-size: 22px;
                margin-top: 15px;
            }

            .total-time-label {
                font-size: 13px;
            }

            .progress-bar-container {
                margin: 15px 0;
                max-width: 100%;
            }

            .controls {
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 20px;
                margin-bottom: 10px;
                width: 100%;
            }

            .controls .btn {
                flex: 1 1 calc(50% - 5px);
                min-width: 140px;
                padding: 14px 20px;
                font-size: 16px;
            }

            .checklist-panel {
                margin-top: 20px;
            }
        }

        /* iPad and Tablet Optimizations */
        @media (max-width: 1024px) and (min-width: 769px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 40px;
                padding: 30px;
            }

            .timer-display {
                font-size: 100px;
            }

            .current-person {
                font-size: 28px;
            }

            .setup-content {
                gap: 15px;
            }

            .checklist-panel {
                padding: 30px;
            }

            .people-overview {
                margin-top: 40px;
            }

            .status-message {
                padding: 60px 30px;
                min-height: 400px;
            }

            .status-icon {
                font-size: 70px;
            }

            .status-title {
                font-size: 28px;
            }

            .btn {
                padding: 14px 24px;
                font-size: 17px;
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Timer Display */
        .timer-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 0;
            flex: 1;
        }

        .current-person {
            font-size: 32px;
            font-weight: 600;
            color: #58a6ff;
            margin-bottom: 20px;
            text-align: center;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        }

        .next-person-info {
            font-size: 18px;
            color: #8b949e;
            margin-bottom: 15px;
            text-align: center;
        }

        .next-person-label {
            margin-right: 8px;
        }

        .next-person-name {
            color: #58a6ff;
            font-weight: 600;
        }

        .schakel-moment-label {
            font-size: 22px;
            font-weight: 600;
            color: #d29922;
            margin-bottom: 12px;
            text-align: center;
        }

        .timer-display {
            font-size: 140px;
            font-weight: 700;
            color: #3fb950;
            margin: 30px 0;
            font-variant-numeric: tabular-nums;
            transition: color 0.3s;
            text-align: center;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            text-shadow: 0 0 20px rgba(63, 185, 80, 0.3);
            letter-spacing: 4px;
        }

        .timer-display.warning {
            color: #d29922;
            text-shadow: 0 0 20px rgba(210, 153, 34, 0.3);
        }

        .timer-display.danger {
            color: #f85149;
            text-shadow: 0 0 20px rgba(248, 81, 73, 0.5);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .progress-bar-container {
            width: 100%;
            max-width: 600px;
            height: 24px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #238636, #3fb950);
            transition: width 0.3s ease;
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(63, 185, 80, 0.3);
        }

        .total-time {
            font-size: 24px;
            color: #c9d1d9;
            margin-top: 20px;
            text-align: center;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        }

        .total-time-label {
            font-size: 14px;
            color: #8b949e;
            margin-top: 5px;
        }

        /* Checklist Panel */
        .checklist-panel {
            background: #0d1117;
            border-radius: 8px;
            padding: 25px;
            border: 1px solid #30363d;
        }

        .checklist-panel h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #58a6ff;
            font-weight: 600;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #161b22;
            border-radius: 6px;
            border: 1px solid #30363d;
            transition: all 0.3s;
            min-height: 60px;
        }

        .checklist-item:hover {
            border-color: #58a6ff;
            box-shadow: 0 2px 8px rgba(88, 166, 255, 0.2);
        }

        .checklist-item input[type="checkbox"] {
            width: 28px;
            height: 28px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #3fb950;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            flex-shrink: 0;
        }

        .checklist-item label {
            font-size: 16px;
            color: #c9d1d9;
            cursor: pointer;
            flex: 1;
        }

        .checklist-item.completed {
            background: rgba(46, 160, 67, 0.1);
            border-color: #238636;
        }

        .checklist-item.completed label {
            text-decoration: line-through;
            color: #8b949e;
        }

        /* People Overview */
        .people-overview {
            margin-top: 30px;
        }

        .people-overview h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #58a6ff;
            font-weight: 600;
        }

        .people-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .person-card {
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #30363d;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 60px;
        }

        .person-card.past {
            background: #0d1117;
            color: #6e7681;
            opacity: 0.6;
            border-color: #21262d;
        }

        .person-card.current {
            background: #1f6feb;
            color: white;
            border-color: #388bfd;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(31, 111, 235, 0.4);
        }

        .person-card.upcoming {
            background: #161b22;
            border-color: #30363d;
            color: #c9d1d9;
        }

        .person-number {
            font-size: 18px;
            font-weight: 600;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        .person-time {
            font-size: 14px;
            color: #8b949e;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        }

        .person-card.current .person-time {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Status Messages */
        .status-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 40px;
            min-height: 500px;
            text-align: center;
        }

        .status-message.active {
            display: none;
        }

        /* Countdown Overlay */
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(13, 17, 23, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .countdown-content {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .countdown-person {
            font-size: 24px;
            color: #8b949e;
            font-weight: 500;
        }

        .countdown-name {
            font-size: 48px;
            color: #58a6ff;
            font-weight: 700;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        }

        .countdown-number {
            font-size: 120px;
            color: #3fb950;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .status-icon {
            font-size: 80px;
            margin-bottom: 30px;
            opacity: 0.6;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .status-title {
            font-size: 32px;
            font-weight: 600;
            color: #58a6ff;
            margin-bottom: 15px;
        }

        .status-text {
            font-size: 18px;
            color: #8b949e;
            max-width: 500px;
            line-height: 1.6;
        }

        .status-hint {
            margin-top: 40px;
            padding: 15px 25px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            color: #c9d1d9;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .status-hint-icon {
            font-size: 20px;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn-pause {
            background: #d29922;
            color: white;
            border: 1px solid #e3b341;
        }

        .btn-pause:hover {
            background: #e3b341;
        }

        .btn-resume {
            background: #238636;
            color: white;
            border: 1px solid #2ea043;
        }

        .btn-resume:hover {
            background: #2ea043;
        }

        .btn-next {
            background: #1f6feb;
            color: white;
            border: 1px solid #388bfd;
        }

        .btn-next:hover {
            background: #388bfd;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(31, 111, 235, 0.3);
        }

        .btn-finish {
            background: #da3633;
            color: white;
            border: 1px solid #f85149;
        }

        .btn-finish:hover {
            background: #f85149;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(248, 81, 73, 0.3);
        }

        /* Responsive */
        /* Mobile and Small Tablets */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 8px;
            }

            .setup-panel {
                padding: 20px;
            }

            .setup-header h1 {
                font-size: 24px;
            }

            .timer-display {
                font-size: 80px;
                letter-spacing: 2px;
            }

            .current-person {
                font-size: 24px;
            }

            .main-content {
                padding: 20px;
                gap: 25px;
            }

            .setup-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                padding: 16px 24px;
                font-size: 17px;
            }

            .checklist-panel {
                padding: 20px;
            }

            .checklist-item {
                padding: 18px;
            }

            .checklist-item input[type="checkbox"] {
                width: 32px;
                height: 32px;
            }

            .person-card {
                padding: 18px;
            }

            .status-message {
                padding: 40px 20px;
                min-height: 300px;
            }

            .status-icon {
                font-size: 60px;
            }

            .status-title {
                font-size: 24px;
            }

            .countdown-name {
                font-size: 36px;
            }

            .countdown-number {
                font-size: 80px;
            }

            .status-text {
                font-size: 16px;
            }

            .status-hint {
                padding: 12px 20px;
                font-size: 13px;
                flex-direction: column;
                text-align: center;
            }

            .fullscreen-btn {
                width: 50px;
                height: 50px;
                bottom: 15px;
                right: 15px;
            }

            .progress-bar-container {
                max-width: 100%;
            }
        }

        /* Landscape iPad */
        @media (max-width: 1024px) and (min-width: 769px) and (orientation: landscape) {
            .main-content {
                grid-template-columns: 1.2fr 0.8fr;
                gap: 30px;
            }

            .timer-display {
                font-size: 90px;
            }

            .status-message {
                min-height: 300px;
                padding: 40px 30px;
            }
        }

        /* Fullscreen button */
        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            width: 56px;
            height: 56px;
            border-radius: 8px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .fullscreen-btn:hover {
            background: #30363d;
            border-color: #58a6ff;
            transform: scale(1.1);
        }

        /* Help button */
        .help-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            width: 56px;
            height: 56px;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .help-btn:hover {
            background: #30363d;
            border-color: #58a6ff;
            transform: scale(1.1);
        }

        /* Help modal overlay */
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .help-modal.active {
            display: flex;
        }

        .help-modal-content {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .help-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .help-modal-header h2 {
            font-size: 28px;
            color: #58a6ff;
            font-weight: 600;
        }

        .help-modal-close {
            background: transparent;
            border: none;
            color: #8b949e;
            font-size: 28px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .help-modal-close:hover {
            background: #21262d;
            color: #c9d1d9;
        }

        .help-shortcuts {
            display: grid;
            gap: 15px;
        }

        .help-shortcut-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
        }

        .help-shortcut-key {
            background: #21262d;
            border: 1px solid #30363d;
            padding: 8px 14px;
            border-radius: 6px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 14px;
            color: #c9d1d9;
            font-weight: 600;
            min-width: 50px;
            text-align: center;
        }

        .help-shortcut-desc {
            color: #c9d1d9;
            font-size: 16px;
            flex: 1;
            margin-left: 20px;
        }

        @media (max-width: 768px) {
            .help-btn {
                width: 50px;
                height: 50px;
                bottom: 15px;
                left: 15px;
                font-size: 20px;
            }

            .help-modal-content {
                padding: 20px;
            }

            .help-modal-header h2 {
                font-size: 24px;
            }

            .help-shortcut-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .help-shortcut-desc {
                margin-left: 0;
            }
        }

        /* Fullscreen mode optimizations */
        :fullscreen,
        :-webkit-full-screen,
        :-moz-full-screen,
        :-ms-fullscreen {
            background: #0d1117;
        }

        :fullscreen body,
        :-webkit-full-screen body,
        :-moz-full-screen body,
        :-ms-fullscreen body {
            padding: 0 !important;
            height: 100vh;
            overflow: hidden;
        }

        :fullscreen .container,
        :-webkit-full-screen .container,
        :-moz-full-screen .container,
        :-ms-fullscreen .container {
            max-width: 100%;
            height: 100vh;
            border-radius: 0;
            border: none;
            box-shadow: none;
            display: flex;
            flex-direction: column;
        }

        :fullscreen .setup-panel,
        :-webkit-full-screen .setup-panel,
        :-moz-full-screen .setup-panel,
        :-ms-fullscreen .setup-panel {
            flex-shrink: 0;
            padding: 15px 20px;
        }

        :fullscreen .main-content,
        :-webkit-full-screen .main-content,
        :-moz-full-screen .main-content,
        :-ms-fullscreen .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 15px;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }

        :fullscreen .timer-section,
        :-webkit-full-screen .timer-section,
        :-moz-full-screen .timer-section,
        :-ms-fullscreen .timer-section {
            min-height: 0;
            flex: 1 1 auto;
            justify-content: flex-start;
            padding-bottom: 10px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        :fullscreen .timer-section > *,
        :-webkit-full-screen .timer-section > *,
        :-moz-full-screen .timer-section > *,
        :-ms-fullscreen .timer-section > * {
            flex-shrink: 0;
        }

        :fullscreen .status-message,
        :-webkit-full-screen .status-message,
        :-moz-full-screen .status-message,
        :-ms-fullscreen .status-message {
            flex: 1;
            min-height: 0;
            padding: 40px 20px;
        }

        /* Fullscreen mode for iPad specifically */
        @media (max-width: 1024px) {
            :fullscreen .timer-display,
            :-webkit-full-screen .timer-display,
            :-moz-full-screen .timer-display,
            :-ms-fullscreen .timer-display {
                font-size: 100px;
                margin: 15px 0;
            }

            :fullscreen .current-person,
            :-webkit-full-screen .current-person,
            :-moz-full-screen .current-person,
            :-ms-fullscreen .current-person {
                font-size: 28px;
                margin-bottom: 15px;
            }

            :fullscreen .main-content,
            :-webkit-full-screen .main-content,
            :-moz-full-screen .main-content,
            :-ms-fullscreen .main-content {
                padding: 10px;
                gap: 15px;
            }

            :fullscreen .timer-section,
            :-webkit-full-screen .timer-section,
            :-moz-full-screen .timer-section,
            :-ms-fullscreen .timer-section {
                padding-bottom: 10px;
            }

            :fullscreen .progress-bar-container,
            :-webkit-full-screen .progress-bar-container,
            :-moz-full-screen .progress-bar-container,
            :-ms-fullscreen .progress-bar-container {
                margin: 15px 0;
            }

            :fullscreen .total-time,
            :-webkit-full-screen .total-time,
            :-moz-full-screen .total-time,
            :-ms-fullscreen .total-time {
                margin-top: 15px;
                font-size: 20px;
            }

            :fullscreen .controls,
            :-webkit-full-screen .controls,
            :-moz-full-screen .controls,
            :-ms-fullscreen .controls {
                margin-top: 15px;
                margin-bottom: 10px;
                padding-bottom: 10px;
            }

            :fullscreen .setup-header h1,
            :-webkit-full-screen .setup-header h1,
            :-moz-full-screen .setup-header h1,
            :-ms-fullscreen .setup-header h1 {
                font-size: 22px;
            }

            :fullscreen .setup-panel,
            :-webkit-full-screen .setup-panel,
            :-moz-full-screen .setup-panel,
            :-ms-fullscreen .setup-panel {
                padding: 12px 15px;
            }

            :fullscreen .checklist-panel,
            :-webkit-full-screen .checklist-panel,
            :-moz-full-screen .checklist-panel,
            :-ms-fullscreen .checklist-panel {
                padding: 20px;
            }
        }

        /* Fullscreen landscape iPad */
        @media (max-width: 1024px) and (orientation: landscape) {
            :fullscreen .main-content,
            :-webkit-full-screen .main-content,
            :-moz-full-screen .main-content,
            :-ms-fullscreen .main-content {
                grid-template-columns: 1.2fr 0.8fr;
            }

            :fullscreen .timer-display,
            :-webkit-full-screen .timer-display,
            :-moz-full-screen .timer-display,
            :-ms-fullscreen .timer-display {
                font-size: 90px;
                margin: 10px 0;
            }

            :fullscreen .current-person,
            :-webkit-full-screen .current-person,
            :-moz-full-screen .current-person,
            :-ms-fullscreen .current-person {
                font-size: 24px;
                margin-bottom: 10px;
            }

            :fullscreen .progress-bar-container,
            :-webkit-full-screen .progress-bar-container,
            :-moz-full-screen .progress-bar-container,
            :-ms-fullscreen .progress-bar-container {
                margin: 10px 0;
            }

            :fullscreen .total-time,
            :-webkit-full-screen .total-time,
            :-moz-full-screen .total-time,
            :-ms-fullscreen .total-time {
                margin-top: 10px;
                font-size: 18px;
            }

            :fullscreen .controls,
            :-webkit-full-screen .controls,
            :-moz-full-screen .controls,
            :-ms-fullscreen .controls {
                margin-top: 10px;
                margin-bottom: 5px;
            }
        }

        /* Fullscreen portrait iPad */
        @media (max-width: 1024px) and (orientation: portrait) {
            :fullscreen .main-content,
            :-webkit-full-screen .main-content,
            :-moz-full-screen .main-content,
            :-ms-fullscreen .main-content {
                grid-template-columns: 1fr;
            }

            :fullscreen .timer-display,
            :-webkit-full-screen .timer-display,
            :-moz-full-screen .timer-display,
            :-ms-fullscreen .timer-display {
                font-size: 90px;
                margin: 10px 0;
            }

            :fullscreen .current-person,
            :-webkit-full-screen .current-person,
            :-moz-full-screen .current-person,
            :-ms-fullscreen .current-person {
                font-size: 26px;
                margin-bottom: 10px;
            }

            :fullscreen .progress-bar-container,
            :-webkit-full-screen .progress-bar-container,
            :-moz-full-screen .progress-bar-container,
            :-ms-fullscreen .progress-bar-container {
                margin: 10px 0;
            }

            :fullscreen .total-time,
            :-webkit-full-screen .total-time,
            :-moz-full-screen .total-time,
            :-ms-fullscreen .total-time {
                margin-top: 10px;
                font-size: 18px;
            }

            :fullscreen .controls,
            :-webkit-full-screen .controls,
            :-moz-full-screen .controls,
            :-ms-fullscreen .controls {
                margin-top: 10px;
                margin-bottom: 5px;
            }
        }

        /* Confetti overlay ‚Äì waterval van boven naar beneden, oneindig tot Reset */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .confetti-piece {
            position: absolute;
            width: 12px;
            height: 12px;
            top: -20px;
            left: var(--start-x, 50%);
            animation: confetti-fall linear forwards;
        }

        .confetti-piece.rect {
            width: 10px;
            height: 18px;
        }

        .confetti-piece.large {
            width: 16px;
            height: 16px;
        }

        .confetti-emoji {
            position: absolute;
            top: -50px;
            left: var(--start-x, 50%);
            font-size: 28px;
            line-height: 1;
            animation: confetti-fall linear forwards;
            text-shadow: 0 0 8px rgba(255,255,255,0.8);
        }

        .confetti-emoji.big {
            font-size: 42px;
        }

        /* Val van boven (buiten beeld) naar beneden (onder beeld weg) */
        @keyframes confetti-fall {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(120vh) translateX(var(--drift, 0)) rotate(720deg);
                opacity: 0.9;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Setup Panel -->
        <div class="setup-panel">
            <div class="setup-header">
                <h1>Standup Timer</h1>
                <button class="toggle-setup" id="toggleSetup">Verberg Setup</button>
            </div>
            <div class="setup-content" id="setupContent">
                <!-- Settings Section -->
                <div class="setup-section">
                    <h3 class="setup-section-title">‚öôÔ∏è Instellingen</h3>
                    <div class="setup-section-content">
                        <div class="input-group">
                            <label>üåê Taal / Language</label>
                            <button class="language-toggle-btn" id="languageToggle" title="Wissel taal / Switch language">üá≥üá±</button>
                        </div>
                        <div class="input-group">
                            <label for="soundEnabled">
                                <input type="checkbox" id="soundEnabled" checked />
                                <span>üîä Geluid inschakelen</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Standup Configuration -->
                <div class="setup-section">
                    <h3 class="setup-section-title">‚è±Ô∏è Standup Configuratie</h3>
                    <div class="setup-section-content">
                        <div class="input-group">
                            <label for="totalDuration" data-i18n="totalDuration">
                                <span class="label-icon">‚è∞</span>
                                <span>Totale duur (minuten)</span>
                            </label>
                            <input type="number" id="totalDuration" min="5" max="60" value="20" />
                            <div class="input-hint" id="durationHint">Tijd wordt automatisch verdeeld over alle aanwezige personen</div>
                        </div>
                    </div>
                </div>
                
                <!-- Personen Management -->
                <div class="setup-section names-management">
                    <h3 class="setup-section-title">üë• Personen</h3>
                    <div class="setup-section-content">
                        <div class="names-list" id="namesList"></div>
                        <div class="add-name-container">
                            <input type="text" id="newNameInput" placeholder="Naam toevoegen..." maxlength="50" />
                            <button class="btn btn-small" id="addNameBtn" title="Naam toevoegen">+</button>
                        </div>
                        <div class="names-hint">
                            <span class="hint-icon">üí°</span>
                            <span>Klik op een naam om aanwezigheid te wisselen (groen = aanwezig, rood = afwezig)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="setup-section actions-section">
                    <h3 class="setup-section-title">üöÄ Acties</h3>
                    <div class="setup-section-content">
                        <div class="button-group-primary">
                            <button class="btn btn-primary btn-large" id="startBtn">
                                <span class="btn-icon">‚ñ∂Ô∏è</span>
                                <span>Start Standup</span>
                            </button>
                        </div>
                        <div class="button-group-secondary">
                            <button class="btn btn-secondary" id="resetBtn" disabled>
                                <span class="btn-icon">üîÑ</span>
                                <span>Reset</span>
                            </button>
                            <button class="btn btn-test" id="testSoundBtn">
                                <span class="btn-icon">üîä</span>
                                <span>Test Geluid</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent" style="display: none;">
            <!-- Timer Section -->
            <div class="timer-section">
                <div class="speaker-order-indicator" id="speakerOrder" style="display: none;"></div>
                <div class="current-person" id="currentPerson">1</div>
                <div class="next-person-info" id="nextPersonInfo" style="display: none;">
                    <span class="next-person-label">Volgende:</span>
                    <span class="next-person-name" id="nextPersonName"></span>
                </div>
                <div class="schakel-moment-label" id="schakelMomentLabel" style="display: none;">Schakel moment ‚Äî Volgende: <span id="nextPersonLabel"></span></div>
                <div class="timer-display" id="timerDisplay">05:30</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 100%;"></div>
                </div>
                <div class="total-time">
                    <div id="totalTimeRemaining">20:00</div>
                    <div class="total-time-label">Totaal resterende tijd</div>
                </div>
                <div class="controls">
                    <button class="btn btn-pause" id="pauseBtn" style="display: none;">Pauze</button>
                    <button class="btn btn-resume" id="resumeBtn" style="display: none;">Hervatten</button>
                    <button class="btn btn-next" id="nextBtn" style="display: none;">
                        <span class="btn-icon">‚è≠Ô∏è</span>
                        <span>Volgende</span>
                    </button>
                    <button class="btn btn-finish" id="finishBtn" style="display: none;">
                        <span class="btn-icon">‚úì</span>
                        <span>Afronden</span>
                    </button>
                </div>
            </div>

            <!-- Sidebar -->
            <div style="display: flex; flex-direction: column; min-height: 0; overflow-y: auto;">
                <!-- Checklist Panel -->
                <div class="checklist-panel">
                    <h2>Checklist</h2>
                    <div id="checklist">
                        <div class="checklist-item">
                            <input type="checkbox" id="check1" />
                            <label for="check1">Gisteren (wat heb je gedaan)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check2" />
                            <label for="check2">Vandaag (wat ga je doen)</label>
                        </div>
                        <div class="checklist-item">
                            <input type="checkbox" id="check3" />
                            <label for="check3">Blokkades (waar loop je tegenaan)</label>
                        </div>
                    </div>
                </div>

                <!-- People Overview - Verborgen tijdens standup voor ruimte -->
                <div class="people-overview" id="peopleOverview" style="display: none;">
                    <h2>Personen</h2>
                    <div class="people-list" id="peopleList"></div>
                </div>
            </div>
        </div>

        <!-- Status Message (shown when not started) -->
        <div class="status-message" id="statusMessage">
            <div class="status-icon">‚è±Ô∏è</div>
            <div class="status-title">Klaar voor de standup</div>
            <div class="status-text">
                Voeg personen toe, vink aan wie er aanwezig is,<br>
                stel de totale duur in en start de timer wanneer iedereen klaar is.
            </div>
            <div class="status-hint">
                <span class="status-hint-icon">üí°</span>
                <span>Tip: Gebruik de test knop om het geluid te controleren</span>
            </div>
        </div>

        <!-- Countdown Overlay (shown before starting) -->
        <div class="countdown-overlay" id="countdownOverlay" style="display: none;">
            <div class="countdown-content">
                <div class="countdown-person">Eerste spreker:</div>
                <div class="countdown-name" id="countdownName"></div>
                <div class="countdown-number" id="countdownNumber">3</div>
            </div>
        </div>
    </div>

    <button class="help-btn" id="helpBtn" title="Help & Keyboard Shortcuts">?</button>
    <button class="fullscreen-btn" id="fullscreenBtn" title="Volledig scherm">‚õ∂</button>

    <!-- Help Modal -->
    <div class="help-modal" id="helpModal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h2>Keyboard Shortcuts</h2>
                <button class="help-modal-close" id="helpModalClose" aria-label="Sluiten">√ó</button>
            </div>
            <div class="help-shortcuts">
                <div class="help-shortcut-item">
                    <span class="help-shortcut-key">Spatie</span>
                    <span class="help-shortcut-desc">Start standup / Pauze / Hervatten</span>
                </div>
                <div class="help-shortcut-item">
                    <span class="help-shortcut-key">N</span>
                    <span class="help-shortcut-desc">Volgende persoon (tijdens standup)</span>
                </div>
                <div class="help-shortcut-item">
                    <span class="help-shortcut-key">F</span>
                    <span class="help-shortcut-desc">Afronden (bij laatste persoon)</span>
                </div>
                <div class="help-shortcut-item">
                    <span class="help-shortcut-key">R</span>
                    <span class="help-shortcut-desc">Reset (wanneer standup niet actief)</span>
                </div>
                <div class="help-shortcut-item">
                    <span class="help-shortcut-key">Esc</span>
                    <span class="help-shortcut-desc">Setup panel tonen/verbergen of help sluiten</span>
                </div>
                <div class="help-shortcut-item">
                    <span class="help-shortcut-key">H</span>
                    <span class="help-shortcut-desc">Help modal openen</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let confettiContainer = null;
        let confettiStopped = false;
        let confettiInterval = null;

        let state = {
            numPeople: 4,
            totalDuration: 20,
            timePerPerson: 0,
            currentPersonIndex: 0,
            people: [],
            timerInterval: null,
            isRunning: false,
            isPaused: false,
            totalElapsedTime: 0,
            inTransition: false,
            transitionTimeRemaining: 0,
            names: [], // Array van {name: string, present: boolean}
            language: 'nl', // 'nl' of 'en'
            soundEnabled: true // Geluid aan/uit (default: aan)
        };

        // Translations
        const translations = {
            nl: {
                totalDuration: 'Totale duur (minuten)',
                persons: 'Personen',
                addNamePlaceholder: 'Naam toevoegen...',
                namesHint: 'Klik op een naam om aanwezigheid te wisselen (groen = aanwezig, rood = afwezig)',
                startStandup: 'Start Standup',
                reset: 'Reset',
                testSound: 'Test Geluid',
                soundEnabled: 'Geluid inschakelen',
                hideSetup: 'Verberg Setup',
                showSetup: 'Toon Setup',
                next: 'Volgende:',
                transitionNext: 'Schakel moment ‚Äî Volgende:',
                totalRemaining: 'Totaal resterende tijd',
                pause: 'Pauze',
                resume: 'Hervatten',
                nextBtn: 'Volgende',
                finish: 'Afronden',
                yesterday: 'Gisteren (wat heb je gedaan)',
                today: 'Vandaag (wat ga je doen)',
                blockers: 'Blokkades (waar loop je tegenaan)',
                ready: 'Klaar voor de standup',
                readyText: 'Voeg personen toe, vink aan wie er aanwezig is,<br>stel de totale duur in en start de timer wanneer iedereen klaar is.',
                tip: 'Tip: Gebruik de test knop om het geluid te controleren',
                firstSpeaker: 'Eerste spreker:',
                firstPerson: 'Eerste persoon',
                finishLabel: 'Afronden',
                person: 'Persoon',
                noNames: 'Geen personen toegevoegd. Voeg een naam toe om te beginnen.',
                delete: 'Verwijderen',
                nameExists: 'Deze naam bestaat al.',
                selectPerson: 'Selecteer minimaal √©√©n persoon die aanwezig is.',
                validDuration: 'Vul een geldige totale duur in (minimaal 1 minuut).',
                helpTitle: 'Toetsenbord sneltoetsen',
                close: 'Sluiten',
                helpShortcuts: {
                    space: 'Start standup / Pauze / Hervatten',
                    spaceKey: 'Spatie',
                    n: 'Volgende persoon (tijdens standup)',
                    nKey: 'N',
                    f: 'Afronden (bij laatste persoon)',
                    fKey: 'F',
                    r: 'Reset (wanneer standup niet actief)',
                    rKey: 'R',
                    esc: 'Setup panel tonen/verbergen of help sluiten',
                    escKey: 'Esc',
                    h: 'Help venster openen',
                    hKey: 'H'
                },
                helpTitleAttr: 'Help & Toetsenbord sneltoetsen',
                fullscreenTitle: 'Volledig scherm',
                settingsTitle: 'Instellingen',
                configTitle: 'Standup Configuratie',
                actionsTitle: 'Acties',
                durationHint: 'Tijd wordt automatisch verdeeld over alle aanwezige personen',
                languageToggleTitle: 'Wissel taal / Switch language',
                addNameTitle: 'Naam toevoegen'
            },
            en: {
                totalDuration: 'Total duration (minutes)',
                persons: 'People',
                addNamePlaceholder: 'Add name...',
                namesHint: 'Click on a name to toggle presence (green = present, red = absent)',
                startStandup: 'Start Standup',
                reset: 'Reset',
                testSound: 'Test Sound',
                soundEnabled: 'Enable sound',
                hideSetup: 'Hide Setup',
                showSetup: 'Show Setup',
                next: 'Next:',
                transitionNext: 'Transition ‚Äî Next:',
                totalRemaining: 'Total remaining time',
                pause: 'Pause',
                resume: 'Resume',
                nextBtn: 'Next',
                finish: 'Finish',
                yesterday: 'Yesterday (what did you do)',
                today: 'Today (what will you do)',
                blockers: 'Blockers (what are you stuck on)',
                ready: 'Ready for standup',
                readyText: 'Add people, mark who is present,<br>set the total duration and start the timer when everyone is ready.',
                tip: 'Tip: Use the test button to check the sound',
                firstSpeaker: 'First speaker:',
                firstPerson: 'First person',
                finishLabel: 'Finish',
                person: 'Person',
                noNames: 'No people added. Add a name to get started.',
                delete: 'Delete',
                nameExists: 'This name already exists.',
                selectPerson: 'Select at least one person who is present.',
                validDuration: 'Enter a valid total duration (minimum 1 minute).',
                helpTitle: 'Keyboard Shortcuts',
                close: 'Close',
                helpShortcuts: {
                    space: 'Start standup / Pause / Resume',
                    spaceKey: 'Space',
                    n: 'Next person (during standup)',
                    nKey: 'N',
                    f: 'Finish (for last person)',
                    fKey: 'F',
                    r: 'Reset (when standup is not active)',
                    rKey: 'R',
                    esc: 'Show/hide setup panel or close help',
                    escKey: 'Esc',
                    h: 'Open help modal',
                    hKey: 'H'
                },
                helpTitleAttr: 'Help & Keyboard Shortcuts',
                fullscreenTitle: 'Fullscreen',
                settingsTitle: 'Settings',
                configTitle: 'Standup Configuration',
                actionsTitle: 'Actions',
                durationHint: 'Time is automatically distributed among all present people',
                languageToggleTitle: 'Switch language',
                addNameTitle: 'Add name'
            }
        };

        // Get translation
        function t(key) {
            return translations[state.language]?.[key] || translations.nl[key] || key;
        }

        // DOM Elements
        const languageToggle = document.getElementById('languageToggle');
        const totalDurationInput = document.getElementById('totalDuration');
        const namesList = document.getElementById('namesList');
        const newNameInput = document.getElementById('newNameInput');
        const addNameBtn = document.getElementById('addNameBtn');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const toggleSetupBtn = document.getElementById('toggleSetup');
        const setupContent = document.getElementById('setupContent');
        const mainContent = document.getElementById('mainContent');
        const statusMessage = document.getElementById('statusMessage');
        const timerDisplay = document.getElementById('timerDisplay');
        const currentPersonDisplay = document.getElementById('currentPerson');
        const progressBar = document.getElementById('progressBar');
        const totalTimeRemaining = document.getElementById('totalTimeRemaining');
        const checklist = document.getElementById('checklist');
        const peopleList = document.getElementById('peopleList');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const nextBtn = document.getElementById('nextBtn');
        const finishBtn = document.getElementById('finishBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const testSoundBtn = document.getElementById('testSoundBtn');
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const helpModalClose = document.getElementById('helpModalClose');
        const schakelMomentLabel = document.getElementById('schakelMomentLabel');
        const nextPersonLabel = document.getElementById('nextPersonLabel');
        const nextPersonInfo = document.getElementById('nextPersonInfo');
        const nextPersonName = document.getElementById('nextPersonName');
        const peopleOverview = document.getElementById('peopleOverview');
        const countdownOverlay = document.getElementById('countdownOverlay');
        const countdownName = document.getElementById('countdownName');
        const countdownNumber = document.getElementById('countdownNumber');
        const soundEnabledCheckbox = document.getElementById('soundEnabled');
        const speakerOrder = document.getElementById('speakerOrder');

        // Load saved settings from localStorage
        function loadSettings() {
            // Initialize defaults
            state.soundEnabled = true; // Default: geluid aan
            
            const saved = localStorage.getItem('standupSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                totalDurationInput.value = settings.totalDuration || 20;
                state.language = settings.language || 'nl';
                // Use saved value if it exists, otherwise keep default true
                if (settings.soundEnabled !== undefined) {
                    state.soundEnabled = settings.soundEnabled;
                }
            }
            // Set checkbox state
            if (soundEnabledCheckbox) {
                soundEnabledCheckbox.checked = state.soundEnabled;
            }
            // Load names
            const savedNames = localStorage.getItem('standupNames');
            if (savedNames) {
                state.names = JSON.parse(savedNames);
            } else {
                // Default namen voor eerste gebruik
                state.names = [];
            }
            // Update language toggle button
            updateLanguageToggle();
            renderNamesList();
            updateTranslations();
        }

        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('standupSettings', JSON.stringify({
                totalDuration: parseInt(totalDurationInput.value),
                language: state.language,
                soundEnabled: state.soundEnabled
            }));
            localStorage.setItem('standupNames', JSON.stringify(state.names));
        }

        // Update all translations
        function updateTranslations() {
            // Setup section titles
            const settingsTitleEl = document.querySelector('.setup-section:first-child .setup-section-title');
            if (settingsTitleEl) settingsTitleEl.textContent = '‚öôÔ∏è ' + t('settingsTitle');
            
            const configTitleEl = document.querySelectorAll('.setup-section')[1]?.querySelector('.setup-section-title');
            if (configTitleEl) configTitleEl.textContent = '‚è±Ô∏è ' + t('configTitle');
            
            const personsTitle = document.querySelector('.names-management .setup-section-title');
            if (personsTitle) personsTitle.textContent = 'üë• ' + t('persons');
            
            const actionsTitleEl = document.querySelector('.actions-section .setup-section-title');
            if (actionsTitleEl) actionsTitleEl.textContent = 'üöÄ ' + t('actionsTitle');
            
            // Setup labels
            const totalDurationLabel = document.querySelector('label[for="totalDuration"] span:last-child');
            if (totalDurationLabel) totalDurationLabel.textContent = t('totalDuration');
            
            const durationHint = document.getElementById('durationHint');
            if (durationHint) durationHint.textContent = t('durationHint');
            
            newNameInput.placeholder = t('addNamePlaceholder');
            const namesHint = document.querySelector('.names-hint span:last-child');
            if (namesHint) namesHint.textContent = t('namesHint');
            namesList.setAttribute('data-empty-text', t('noNames'));
            
            // Update titles/attributes
            if (languageToggle) languageToggle.setAttribute('title', t('languageToggleTitle'));
            if (addNameBtn) addNameBtn.setAttribute('title', t('addNameTitle'));
            
            // Buttons - update text content while preserving icons
            const startBtnText = startBtn.querySelector('span:last-child');
            if (startBtnText) startBtnText.textContent = t('startStandup');
            const resetBtnText = resetBtn.querySelector('span:last-child');
            if (resetBtnText) resetBtnText.textContent = t('reset');
            const testSoundBtnText = testSoundBtn.querySelector('span:last-child');
            if (testSoundBtnText) testSoundBtnText.textContent = t('testSound');
            const soundLabel = document.querySelector('label[for="soundEnabled"] span:last-child');
            if (soundLabel) soundLabel.textContent = t('soundEnabled');
            const isHidden = setupContent.classList.contains('hidden');
            toggleSetupBtn.textContent = isHidden ? t('showSetup') : t('hideSetup');
            
            // Timer section
            document.querySelector('.next-person-label').textContent = t('next');
            document.querySelector('.total-time-label').textContent = t('totalRemaining');
            pauseBtn.textContent = t('pause');
            resumeBtn.textContent = t('resume');
            // Buttons with icons - update text only
            const nextBtnText = nextBtn.querySelector('span:last-child');
            if (nextBtnText) nextBtnText.textContent = t('nextBtn');
            else nextBtn.textContent = '‚è≠Ô∏è ' + t('nextBtn');
            
            const finishBtnText = finishBtn.querySelector('span:last-child');
            if (finishBtnText) finishBtnText.textContent = t('finish');
            else finishBtn.textContent = '‚úì ' + t('finish');
            
            // Checklist
            document.querySelector('label[for="check1"]').textContent = t('yesterday');
            document.querySelector('label[for="check2"]').textContent = t('today');
            document.querySelector('label[for="check3"]').textContent = t('blockers');
            
            // Status message
            document.querySelector('.status-title').textContent = t('ready');
            document.querySelector('.status-text').innerHTML = t('readyText');
            document.querySelector('.status-hint span:last-child').textContent = t('tip');
            
            // Countdown
            document.querySelector('.countdown-person').textContent = t('firstSpeaker');
            
            // Help modal
            document.querySelector('.help-modal-header h2').textContent = t('helpTitle');
            document.querySelector('.help-modal-close').setAttribute('aria-label', t('close'));
            helpBtn.setAttribute('title', t('helpTitleAttr'));
            fullscreenBtn.setAttribute('title', t('fullscreenTitle'));
            
            // Help shortcuts - update both keys and descriptions
            const shortcutItems = document.querySelectorAll('.help-shortcut-item');
            if (shortcutItems.length >= 5) {
                const shortcuts = t('helpShortcuts');
                // Space
                const spaceKey = shortcutItems[0].querySelector('.help-shortcut-key');
                const spaceDesc = shortcutItems[0].querySelector('.help-shortcut-desc');
                if (spaceKey) spaceKey.textContent = shortcuts.spaceKey || 'Spatie';
                if (spaceDesc) spaceDesc.textContent = shortcuts.space;
                // N
                const nKey = shortcutItems[1].querySelector('.help-shortcut-key');
                const nDesc = shortcutItems[1].querySelector('.help-shortcut-desc');
                if (nKey) nKey.textContent = shortcuts.nKey || 'N';
                if (nDesc) nDesc.textContent = shortcuts.n;
                // F
                const fKey = shortcutItems[2].querySelector('.help-shortcut-key');
                const fDesc = shortcutItems[2].querySelector('.help-shortcut-desc');
                if (fKey) fKey.textContent = shortcuts.fKey || 'F';
                if (fDesc) fDesc.textContent = shortcuts.f;
                // R
                const rKey = shortcutItems[3].querySelector('.help-shortcut-key');
                const rDesc = shortcutItems[3].querySelector('.help-shortcut-desc');
                if (rKey) rKey.textContent = shortcuts.rKey || 'R';
                if (rDesc) rDesc.textContent = shortcuts.r;
                // Esc
                const escKey = shortcutItems[4].querySelector('.help-shortcut-key');
                const escDesc = shortcutItems[4].querySelector('.help-shortcut-desc');
                if (escKey) escKey.textContent = shortcuts.escKey || 'Esc';
                if (escDesc) escDesc.textContent = shortcuts.esc;
                // H
                if (shortcutItems.length >= 6) {
                    const hKey = shortcutItems[5].querySelector('.help-shortcut-key');
                    const hDesc = shortcutItems[5].querySelector('.help-shortcut-desc');
                    if (hKey) hKey.textContent = shortcuts.hKey || 'H';
                    if (hDesc) hDesc.textContent = shortcuts.h;
                }
            }
            
            // Update schakelmoment label template
            const schakelLabel = document.getElementById('schakelMomentLabel');
            if (schakelLabel) {
                const transitionText = t('transitionNext');
                schakelLabel.innerHTML = transitionText + ' <span id="nextPersonLabel"></span>';
            }
        }

        // Render names list
        function renderNamesList() {
            namesList.innerHTML = '';
            state.names.forEach((item, index) => {
                const nameItem = document.createElement('div');
                nameItem.className = 'name-item' + (item.present ? ' present' : ' absent');
                
                // Click op hele item toggle aanwezigheid (behalve op delete button)
                nameItem.addEventListener('click', (e) => {
                    // Als klik op delete button, niet toggle
                    if (e.target.classList.contains('delete-btn')) {
                        return;
                    }
                    item.present = !item.present;
                    nameItem.className = 'name-item' + (item.present ? ' present' : ' absent');
                    saveSettings();
                });
                
                const nameText = document.createElement('span');
                nameText.className = 'name-text';
                nameText.textContent = item.name;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '√ó';
                deleteBtn.title = t('delete');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Voorkom dat click op item ook wordt getriggerd
                    state.names.splice(index, 1);
                    renderNamesList();
                    saveSettings();
                });
                
                nameItem.appendChild(nameText);
                nameItem.appendChild(deleteBtn);
                namesList.appendChild(nameItem);
            });
        }

        // Add name
        function addName() {
            const name = newNameInput.value.trim();
            if (name && name.length > 0) {
                // Check if name already exists
                if (!state.names.some(n => n.name.toLowerCase() === name.toLowerCase())) {
                    state.names.push({ name: name, present: true });
                    renderNamesList();
                    saveSettings();
                    newNameInput.value = '';
                    newNameInput.focus();
                } else {
                    alert(t('nameExists'));
                }
            }
        }

        // Tijd per persoon zodat totaal = spreektijden + schakelmomenten (10% per overgang).
        // n√óT + (n-1)√ó0.1√óT = totaal ‚Üí T = totaal / (1.1√ón - 0.1)
        function calculateTimePerPerson() {
            const totalSec = state.totalDuration * 60;
            const n = state.numPeople;
            const divisor = 1.1 * n - 0.1; // n spreektijden + (n-1) schakelmomenten van 10%
            return Math.floor(totalSec / divisor);
        }

        // Shuffle array (Fisher-Yates algoritme)
        function shuffleArray(array) {
            const shuffled = [...array]; // Maak kopie om origineel niet te wijzigen
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Initialize people array - alleen aangevinkte namen, in willekeurige volgorde
        // Berekent timePerPerson en initialiseert state.people met geschudde namen
        function initializePeople() {
            const presentNames = state.names.filter(n => n.present);
            state.numPeople = presentNames.length;
            
            if (state.numPeople === 0) {
                throw new Error('Selecteer minimaal √©√©n persoon die aanwezig is.');
            }
            
            // Bereken tijd per persoon op basis van aantal aangevinkte personen
            state.timePerPerson = calculateTimePerPerson();
            
            // Shuffle de namen voor willekeurige volgorde
            const shuffledNames = shuffleArray(presentNames);
            
            state.people = [];
            shuffledNames.forEach((nameItem, i) => {
                state.people.push({
                    index: i + 1,
                    name: nameItem.name,
                    timeRemaining: state.timePerPerson,
                    completed: false
                });
            });
        }

        // Play simple countdown beep
        function playCountdownBeep() {
            if (!state.soundEnabled) return;
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Resume audio context als deze suspended is (browser autoplay policy)
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        playBeepSound(audioContext);
                    }).catch(() => {
                        playBeepSound(audioContext);
                    });
                } else {
                    playBeepSound(audioContext);
                }
            } catch (e) {
                console.log('Countdown beep not available:', e);
            }
        }

        // Helper functie om daadwerkelijk het beep geluid te maken
        function playBeepSound(audioContext) {
            try {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                // Simpele beep: korte, scherpe toon - luider gemaakt
                osc.frequency.value = 800; // Midden-hoog toon
                osc.type = 'sine';

                const t = audioContext.currentTime;
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.3, t + 0.01); // Snelle attack, luider
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.2); // Korte decay

                osc.start(t);
                osc.stop(t + 0.2);
            } catch (e) {
                console.log('Beep sound error:', e);
            }
        }

        // Play start sound (boxring-achtig: twee korte tonen)
        function playStartSound() {
            if (!state.soundEnabled) return;
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                function playTone(frequency, startTime, duration, volume) {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();

                    osc.connect(gain);
                    gain.connect(audioContext.destination);

                    osc.frequency.value = frequency;
                    osc.type = 'sine';

                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(volume, startTime + 0.01);
                    gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);

                    osc.start(startTime);
                    osc.stop(startTime + duration);
                }

                const t = audioContext.currentTime;
                const vol = 0.2;
                
                // Twee korte tonen zoals een boxring: "ding ding"
                playTone(1000, t, 0.1, vol);        // Eerste ding (hogere toon)
                playTone(800, t + 0.15, 0.1, vol);  // Tweede ding (lagere toon)
            } catch (e) {
                console.log('Start sound not available:', e);
            }
        }

        // Play sound notification - Pleasant chime
        function playNotificationSound() {
            if (!state.soundEnabled) return;
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Soft chime: play a note with gentle attack and decay
                function playChime(frequency, startTime, duration, volume) {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();

                    osc.connect(gain);
                    gain.connect(audioContext.destination);

                    osc.frequency.value = frequency;
                    osc.type = 'sine';

                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(volume, startTime + 0.02);
                    gain.gain.linearRampToValueAtTime(volume * 0.6, startTime + duration * 0.4);
                    gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);

                    osc.start(startTime);
                    osc.stop(startTime + duration);
                }

                const t = audioContext.currentTime;
                const vol = 0.25;

                // Ascending three-note chime (C5 - E5 - G5, major arpeggio)
                playChime(523.25, t, 0.35, vol);       // C5
                playChime(659.25, t + 0.12, 0.4, vol);  // E5
                playChime(783.99, t + 0.28, 0.5, vol);  // G5
                
            } catch (e) {
                console.log('Audio notification not available:', e);
            }
        }

        // Uitbundig feestgeluid bij afronden standup
        function playCompletionSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const v = 0.22;

                function note(freq, start, duration, vol) {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.frequency.value = freq;
                    osc.type = 'sine';
                    gain.gain.setValueAtTime(0, start);
                    gain.gain.linearRampToValueAtTime(vol, start + 0.015);
                    gain.gain.exponentialRampToValueAtTime(0.001, start + duration);
                    osc.start(start);
                    osc.stop(start + duration);
                }

                function chord(freqs, start, duration, vol) {
                    freqs.forEach(function(f) { note(f, start, duration, vol); });
                }

                const t = ctx.currentTime;
                // Opbouw: korte vrolijke staccato-noten omhoog (C-majeur arpeggio)
                note(523.25, t, 0.12, v);       // C5
                note(659.25, t + 0.08, 0.12, v);  // E5
                note(783.99, t + 0.16, 0.12, v);  // G5
                note(1046.50, t + 0.24, 0.12, v); // C6
                note(1318.51, t + 0.32, 0.14, v); // E6
                note(1567.98, t + 0.40, 0.18, v); // G6
                // Topnoot ‚Äì korte ‚Äúpiek‚Äù
                note(2093.00, t + 0.52, 0.25, v * 1.1); // C7
                // Grote triomfantelijke slotakkoord (C-majeur, laag tot hoog)
                chord([523.25, 659.25, 783.99, 1046.50, 1318.51], t + 0.72, 1.0, v);
            } catch (e) {
                console.log('Completion sound not available:', e);
            }
        }

        // Voeg confetti toe aan container - natuurlijke continue stroom
        function addConfettiBatch(container) {
            if (confettiStopped || !container || !container.parentNode) return;
            
            const colors = ['#3fb950', '#58a6ff', '#f85149', '#d29922', '#a371f7', '#79c0ff', '#ff7b72', '#ffa657', '#7ee787', '#ffde5c'];
            const emojis = ['üéâ', 'üéä', '‚≠ê', '‚ú®', 'üèÜ', 'üëç', 'üí™', 'üéà', 'üåü', '‚úÖ', 'üî•', 'üíØ', 'ü•≥', 'üëè', 'üéØ'];
            
            // Meer confetti voor rijkere waterval: 5-12 confetti stukjes
            const pieceCount = 5 + Math.floor(Math.random() * 7);
            for (let i = 0; i < pieceCount; i++) {
                const piece = document.createElement('div');
                let cls = 'confetti-piece';
                if (Math.random() > 0.5) cls += ' rect';
                if (Math.random() > 0.75) cls += ' large';
                piece.className = cls;
                piece.style.setProperty('--start-x', Math.random() * 100 + '%');
                piece.style.setProperty('--drift', (Math.random() - 0.5) * 80 + 'px');
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDuration = (2 + Math.random() * 2) + 's'; // Langzamer: 2-4s
                piece.style.animationDelay = (Math.random() * 0.1) + 's'; // Kleine variatie in start
                piece.style.borderRadius = Math.random() > 0.6 ? '50%' : '0';
                container.appendChild(piece);
            }
            
            // Vaker emoji's voor meer feest: 50% kans
            if (Math.random() > 0.5) {
                const emojiCount = 1 + Math.floor(Math.random() * 2); // 1-2 emoji's per batch
                for (let i = 0; i < emojiCount; i++) {
                    const em = document.createElement('div');
                    em.className = 'confetti-emoji' + (Math.random() > 0.6 ? ' big' : '');
                    em.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    em.style.setProperty('--start-x', Math.random() * 100 + '%');
                    em.style.setProperty('--drift', (Math.random() - 0.5) * 100 + 'px');
                    em.style.animationDuration = (2.5 + Math.random() * 2) + 's'; // Langzamer: 2.5-4.5s
                    em.style.animationDelay = (Math.random() * 0.1) + 's';
                    container.appendChild(em);
                }
            }
        }

        // Confetti waterval ‚Äì van boven naar beneden, oneindig tot op Reset wordt geklikt
        function triggerConfetti() {
            if (confettiContainer) {
                confettiContainer.remove();
            }
            if (confettiInterval) {
                clearInterval(confettiInterval);
            }
            
            confettiStopped = false;
            const container = document.createElement('div');
            container.className = 'confetti-container';
            document.body.appendChild(container);
            confettiContainer = container;

            // Start met meer batches voor direct effect
            for (let i = 0; i < 8; i++) {
                setTimeout(() => addConfettiBatch(container), i * 40);
            }
            
            // Voeg continu batches toe voor natuurlijke waterval
            // Variabele interval voor natuurlijker patroon
            function scheduleNextBatch() {
                if (confettiStopped || !container || !container.parentNode) {
                    clearTimeout(confettiInterval);
                    confettiInterval = null;
                    return;
                }
                addConfettiBatch(container);
                // Volgende batch na 50-100ms (vaker spawnen voor meer confetti)
                const nextDelay = 50 + Math.random() * 50;
                confettiInterval = setTimeout(scheduleNextBatch, nextDelay);
            }
            
            // Start de continue stroom
            confettiInterval = setTimeout(scheduleNextBatch, 80);
        }

        function stopConfetti() {
            // Stop met nieuwe confetti spawnen
            confettiStopped = true;
            if (confettiInterval) {
                clearTimeout(confettiInterval);
                confettiInterval = null;
            }
            
            if (confettiContainer) {
                // Verwijder container na langste animatie duur (max duration)
                // zodat alle confetti natuurlijk kan doorvallen en het scherm schoon wordt
                setTimeout(function() {
                    if (confettiContainer && confettiContainer.parentNode) {
                        confettiContainer.remove();
                        confettiContainer = null;
                    }
                }, 6000); // 4.5s max duration + buffer
            }
        }

        // Format time as MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Update timer display
        function updateTimerDisplay() {
            updateSpeakerOrder();
            
            if (state.inTransition) {
                currentPersonDisplay.style.display = 'none';
                nextPersonInfo.style.display = 'none';
                schakelMomentLabel.style.display = 'block';
                const isLast = state.currentPersonIndex >= state.numPeople - 1;
                if (isLast) {
                    nextPersonLabel.textContent = t('finishLabel');
                } else {
                    const nextPerson = state.people[state.currentPersonIndex + 1];
                    nextPersonLabel.textContent = nextPerson ? nextPerson.name : (state.currentPersonIndex + 2).toString();
                }
                timerDisplay.textContent = formatTime(state.transitionTimeRemaining);
                timerDisplay.classList.remove('warning', 'danger');
                timerDisplay.classList.add('warning');
                progressBar.style.width = '0%';
                const totalRemaining = state.people.reduce((sum, p) => sum + p.timeRemaining, 0) + state.transitionTimeRemaining;
                totalTimeRemaining.textContent = formatTime(totalRemaining);
                return;
            }

            currentPersonDisplay.style.display = 'block';
            schakelMomentLabel.style.display = 'none';

            const currentPerson = state.people[state.currentPersonIndex];
            if (!currentPerson) return;

            // Toon naam in plaats van nummer
            currentPersonDisplay.textContent = currentPerson.name || `${currentPerson.index}`;

            // Toon volgende persoon info (als er een volgende is)
            const isLast = state.currentPersonIndex >= state.numPeople - 1;
            if (isLast) {
                nextPersonInfo.style.display = 'none';
            } else {
                const nextPerson = state.people[state.currentPersonIndex + 1];
                nextPersonInfo.style.display = 'block';
                nextPersonName.textContent = nextPerson.name || `${t('person')} ${nextPerson.index}`;
            }

            const timeRemaining = currentPerson.timeRemaining;
            timerDisplay.textContent = formatTime(timeRemaining);

            // Update visual state
            timerDisplay.classList.remove('warning', 'danger');
            if (timeRemaining <= 30) {
                timerDisplay.classList.add('danger');
            } else if (timeRemaining <= 60) {
                timerDisplay.classList.add('warning');
            }

            // Update progress bar
            const progress = (timeRemaining / state.timePerPerson) * 100;
            progressBar.style.width = `${progress}%`;

            // Update total time remaining
            const totalRemaining = state.people.reduce((sum, p) => sum + p.timeRemaining, 0);
            totalTimeRemaining.textContent = formatTime(totalRemaining);
        }

        // Update speaker order indicator
        function updateSpeakerOrder() {
            if (!speakerOrder || !state.isRunning) return;
            
            speakerOrder.innerHTML = '';
            speakerOrder.style.display = 'flex';
            
            state.people.forEach((person, index) => {
                const item = document.createElement('div');
                item.className = 'speaker-order-item';
                
                if (index < state.currentPersonIndex) {
                    item.className += ' past';
                } else if (index === state.currentPersonIndex) {
                    item.className += ' current';
                } else {
                    item.className += ' upcoming';
                }
                
                item.textContent = person.name || `${t('person')} ${person.index}`;
                speakerOrder.appendChild(item);
            });
        }

        // Update people list display (alleen renderen als zichtbaar)
        function updatePeopleList() {
            // Skip rendering als lijst verborgen is (tijdens standup)
            if (peopleOverview.style.display === 'none') {
                return;
            }
            
            peopleList.innerHTML = '';
            state.people.forEach((person, index) => {
                const card = document.createElement('div');
                let className = 'person-card';
                
                if (index < state.currentPersonIndex) {
                    className += ' past';
                } else if (index === state.currentPersonIndex) {
                    className += ' current';
                } else {
                    className += ' upcoming';
                }

                card.className = className;
                const name = person.name || `${t('person')} ${person.index}`;
                card.innerHTML = `
                    <div>
                        <div class="person-number">${name}</div>
                        <div class="person-time">${formatTime(person.timeRemaining)}</div>
                    </div>
                `;
                peopleList.appendChild(card);
            });
        }

        // Reset checklist
        function resetChecklist() {
            const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = false;
                const item = cb.closest('.checklist-item');
                item.classList.remove('completed');
            });
        }

        // Update checklist event listeners
        function setupChecklistListeners() {
            const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.addEventListener('change', function() {
                    const item = this.closest('.checklist-item');
                    if (this.checked) {
                        item.classList.add('completed');
                    } else {
                        item.classList.remove('completed');
                    }
                });
            });
        }

        // Move to next person
        function moveToNextPerson(playSound = true) {
            // Als we in een schakelmoment zitten, stop dat eerst
            if (state.inTransition) {
                state.inTransition = false;
                state.transitionTimeRemaining = 0;
            }

            const currentPerson = state.people[state.currentPersonIndex];
            if (currentPerson) {
                currentPerson.completed = true;
                currentPerson.timeRemaining = 0; // Zodat totale resterende tijd correct wordt herberekend
            }

            if (playSound) {
                // Play notification sound
                playNotificationSound();
            }

            // Move to next person
            if (state.currentPersonIndex < state.numPeople - 1) {
                state.currentPersonIndex++;
                const nextPerson = state.people[state.currentPersonIndex];
                currentPersonDisplay.textContent = nextPerson ? nextPerson.name : `${state.currentPersonIndex + 1}`;
                resetChecklist();
                
                // Update button visibility
                updateControlButtons();
                
                updateTimerDisplay();
                // updatePeopleList() niet nodig - lijst is verborgen tijdens standup
            } else {
                // All people done
                state.inTransition = false;
                stopTimer();
                playCompletionSound();
                triggerConfetti();
                showSetupPanel();
                return;
            }
        }

        // Update control buttons visibility
        function updateControlButtons() {
            if (!state.isRunning) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'none';
                pauseBtn.style.display = 'none';
                resumeBtn.style.display = 'none';
                return;
            }

            if (state.inTransition) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'none';
                pauseBtn.style.display = 'none';
                resumeBtn.style.display = 'none';
                return;
            }

            const isLastPerson = state.currentPersonIndex >= state.numPeople - 1;
            
            nextBtn.style.display = isLastPerson ? 'none' : 'inline-block';
            finishBtn.style.display = isLastPerson ? 'inline-block' : 'none';
            pauseBtn.style.display = state.isPaused ? 'none' : 'inline-block';
            resumeBtn.style.display = state.isPaused ? 'inline-block' : 'none';
        }

        // Timer tick
        function timerTick() {
            if (!state.isRunning || state.isPaused) return;

            if (state.inTransition) {
                state.transitionTimeRemaining -= 1;
                state.totalElapsedTime += 1;
                if (state.transitionTimeRemaining <= 0) {
                    state.inTransition = false;
                    moveToNextPerson(false); // Geluid al afgespeeld bij start schakelmoment
                }
                updateTimerDisplay();
                return;
            }

            const currentPerson = state.people[state.currentPersonIndex];
            if (!currentPerson) return;

            currentPerson.timeRemaining -= 1;
            state.totalElapsedTime += 1;

            if (currentPerson.timeRemaining <= 0) {
                currentPerson.timeRemaining = 0;
                // Eindgeluid (boxring-achtig) om aan te geven dat spreektijd voorbij is
                playStartSound(); // Hergebruik het startgeluid voor consistentie
                // Start schakelmoment: 10% van spreektijd
                state.inTransition = true;
                state.transitionTimeRemaining = Math.max(1, Math.ceil(state.timePerPerson * 0.1));
            }

            updateTimerDisplay();
            // updatePeopleList() niet nodig tijdens timer - lijst is verborgen
        }

        // Start countdown before timer
        function startCountdown() {
            const totalDuration = parseInt(totalDurationInput.value, 10);

            // Check if at least one person is present
            const presentCount = state.names.filter(n => n.present).length;
            if (presentCount === 0) {
                alert(t('selectPerson'));
                newNameInput.focus();
                return;
            }

            if (isNaN(totalDuration) || totalDuration < 1) {
                alert(t('validDuration'));
                totalDurationInput.focus();
                return;
            }

            state.totalDuration = totalDuration;
            
            try {
                initializePeople(); // Dit zet state.numPeople, berekent timePerPerson en initialiseert state.people
            } catch (error) {
                alert(error.message);
                return;
            }

            // Hide setup panel
            setupContent.classList.add('hidden');
            toggleSetupBtn.textContent = t('showSetup');
            startBtn.disabled = true;
            resetBtn.disabled = false;

            // Show countdown overlay
            const firstPerson = state.people[0];
            countdownName.textContent = firstPerson ? firstPerson.name : t('firstPerson');
            countdownOverlay.style.display = 'flex';
            
            let countdown = 3;
            countdownNumber.textContent = countdown;
            // Speel direct geluid bij 3
            playCountdownBeep();

            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    countdownNumber.textContent = countdown;
                    playCountdownBeep(); // Simpele beep voor elke seconde
                } else {
                    clearInterval(countdownInterval);
                    countdownOverlay.style.display = 'none';
                    // Start geluid (boxring-achtig)
                    playStartSound();
                    // Start de echte timer
                    startTimerAfterCountdown();
                }
            }, 1000);
        }

        // Start timer after countdown
        function startTimerAfterCountdown() {
            state.currentPersonIndex = 0;
            state.isRunning = true;
            state.isPaused = false;
            state.totalElapsedTime = 0;
            state.inTransition = false;
            state.transitionTimeRemaining = 0;

            // Verberg personen lijst tijdens standup voor ruimte
            peopleOverview.style.display = 'none';

            updateTimerDisplay();
            resetChecklist();
            setupChecklistListeners();

            // Show main content, hide status message
            mainContent.style.display = 'grid';
            statusMessage.classList.add('active');

            // Start interval
            state.timerInterval = setInterval(timerTick, 1000);

            // Update buttons
            pauseBtn.style.display = 'inline-block';
            resumeBtn.style.display = 'none';
            updateControlButtons();

            saveSettings();
        }

        // Start timer (entry point - now starts countdown)
        function startTimer() {
            startCountdown();
        }

        // Stop timer
        function stopTimer() {
            state.isRunning = false;
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
        }

        // Pause timer
        function pauseTimer() {
            state.isPaused = true;
            pauseBtn.style.display = 'none';
            resumeBtn.style.display = 'inline-block';
            updateControlButtons();
        }

        // Resume timer
        function resumeTimer() {
            state.isPaused = false;
            pauseBtn.style.display = 'inline-block';
            resumeBtn.style.display = 'none';
            updateControlButtons();
        }

        // Go to next person manually
        function goToNextPerson() {
            if (state.currentPersonIndex < state.numPeople - 1) {
                moveToNextPerson(false); // Don't play sound for manual advance
            }
        }

        // Finish standup
        function finishStandup() {
            stopTimer();
            
            // Stop eventuele schakelmoment
            state.inTransition = false;
            state.transitionTimeRemaining = 0;
            
            // Mark current person as completed
            const currentPerson = state.people[state.currentPersonIndex];
            if (currentPerson) {
                currentPerson.completed = true;
                currentPerson.timeRemaining = 0;
            }
            
            // Feestelijk afronden
            playCompletionSound();
            triggerConfetti();
            showSetupPanel();
            
            // Enable reset button and add highlight effect
            resetBtn.disabled = false;
            resetBtn.classList.add('standup-complete');
            
            // Update display
            updateTimerDisplay();
            updateControlButtons();
            // updatePeopleList() niet nodig - standup is afgelopen
        }

        // Reset timer
        function resetTimer() {
            stopTimer();
            state.currentPersonIndex = 0;
            state.isRunning = false;
            state.isPaused = false;
            state.totalElapsedTime = 0;
            state.inTransition = false;
            state.transitionTimeRemaining = 0;

            // Hide countdown overlay if visible
            countdownOverlay.style.display = 'none';

            mainContent.style.display = 'none';
            statusMessage.classList.remove('active');

            stopConfetti();

            // Show setup panel again when resetting
            setupContent.classList.remove('hidden');
            toggleSetupBtn.textContent = t('hideSetup');

            startBtn.disabled = false;
            resetBtn.disabled = true;
            resetBtn.classList.remove('standup-complete'); // Remove highlight effect
            pauseBtn.style.display = 'none';
            resumeBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            finishBtn.style.display = 'none';

            timerDisplay.classList.remove('warning', 'danger');
        }

        // Show setup panel (e.g. after standup ends)
        function showSetupPanel() {
            setupContent.classList.remove('hidden');
            toggleSetupBtn.textContent = t('hideSetup');
            // Scroll setup into view so user sees Start/Reset
            document.querySelector('.setup-panel').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Toggle setup panel
        function toggleSetup() {
            setupContent.classList.toggle('hidden');
            toggleSetupBtn.textContent = setupContent.classList.contains('hidden') 
                ? t('showSetup') 
                : t('hideSetup');
        }

        // Fullscreen functionality
        function toggleFullscreen() {
            const element = document.documentElement;
            
            if (!document.fullscreenElement && 
                !document.webkitFullscreenElement && 
                !document.mozFullScreenElement && 
                !document.msFullscreenElement) {
                // Enter fullscreen
                if (element.requestFullscreen) {
                    element.requestFullscreen().catch(err => {
                        console.log('Fullscreen not supported');
                    });
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen();
                } else if (element.mozRequestFullScreen) {
                    element.mozRequestFullScreen();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                }
                fullscreenBtn.textContent = '‚õ∂';
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                fullscreenBtn.textContent = '‚õ∂';
            }
        }

        // Test sound function
        function testSound() {
            playNotificationSound();
        }

        // Event Listeners
        startBtn.addEventListener('click', startTimer);
        resetBtn.addEventListener('click', resetTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resumeBtn.addEventListener('click', resumeTimer);
        nextBtn.addEventListener('click', goToNextPerson);
        finishBtn.addEventListener('click', finishStandup);
        toggleSetupBtn.addEventListener('click', toggleSetup);
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        testSoundBtn.addEventListener('click', testSound);
        helpBtn.addEventListener('click', openHelpModal);
        helpModalClose.addEventListener('click', closeHelpModal);
        
        // Sound toggle
        if (soundEnabledCheckbox) {
            soundEnabledCheckbox.addEventListener('change', function() {
                state.soundEnabled = this.checked;
                saveSettings();
            });
        }
        
        // Update language toggle button display
        function updateLanguageToggle() {
            const languages = ['nl', 'en'];
            const emojis = { 'nl': 'üá≥üá±', 'en': 'üá¨üáß' };
            const titles = { 'nl': 'Nederlands', 'en': 'English' };
            
            languageToggle.textContent = emojis[state.language];
            languageToggle.title = `${titles[state.language]} - Wissel taal / Switch language`;
        }

        // Language toggle - cycle through languages
        languageToggle.addEventListener('click', function() {
            const languages = ['nl', 'en'];
            const currentIndex = languages.indexOf(state.language);
            const nextIndex = (currentIndex + 1) % languages.length;
            state.language = languages[nextIndex];
            
            updateLanguageToggle();
            saveSettings();
            updateTranslations();
        });

        // Name management
        addNameBtn.addEventListener('click', addName);
        newNameInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addName();
            }
        });
        
        // Close modal when clicking outside
        helpModal.addEventListener('click', function(e) {
            if (e.target === helpModal) {
                closeHelpModal();
            }
        });

        // Update fullscreen button text when entering/exiting fullscreen
        function handleFullscreenChange() {
            const isFullscreen = !!(document.fullscreenElement || 
                                   document.webkitFullscreenElement || 
                                   document.mozFullScreenElement || 
                                   document.msFullscreenElement);
            
            if (isFullscreen) {
                fullscreenBtn.textContent = '‚õ∂';
                document.body.classList.add('fullscreen-active');
                document.body.style.padding = '0';
            } else {
                fullscreenBtn.textContent = '‚õ∂';
                document.body.classList.remove('fullscreen-active');
                document.body.style.padding = '';
            }
        }

        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Don't trigger shortcuts when typing in inputs
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }

            // Spacebar: Start/Pause/Resume
            if (e.code === 'Space' && !e.target.closest('button')) {
                e.preventDefault();
                if (!state.isRunning) {
                    if (!startBtn.disabled) startTimer();
                } else if (state.isPaused) {
                    resumeTimer();
                } else {
                    pauseTimer();
                }
            }

            // N: Next person
            if (e.code === 'KeyN' && state.isRunning && !state.isPaused) {
                if (nextBtn.style.display !== 'none') {
                    goToNextPerson();
                }
            }

            // F: Finish (when on last person)
            if (e.code === 'KeyF' && state.isRunning && !state.isPaused) {
                if (finishBtn.style.display !== 'none') {
                    finishStandup();
                }
            }

            // R: Reset (when not running)
            if (e.code === 'KeyR' && !state.isRunning) {
                if (!resetBtn.disabled) {
                    resetTimer();
                }
            }

            // Escape: Toggle setup panel or close help modal
            if (e.code === 'Escape') {
                if (helpModal.classList.contains('active')) {
                    closeHelpModal();
                } else {
                    toggleSetup();
                }
            }

            // H: Open help modal
            if (e.code === 'KeyH' && !helpModal.classList.contains('active')) {
                openHelpModal();
            }
        });

        // Help modal functions
        function openHelpModal() {
            helpModal.classList.add('active');
        }

        function closeHelpModal() {
            helpModal.classList.remove('active');
        }

        // Initialize
        loadSettings();
        setupChecklistListeners();
    </script>
</body>
</html>
